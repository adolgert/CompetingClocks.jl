<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Hierarchical Samplers · Fleck.jl</title><meta name="title" content="Hierarchical Samplers · Fleck.jl"/><meta property="og:title" content="Hierarchical Samplers · Fleck.jl"/><meta property="twitter:title" content="Hierarchical Samplers · Fleck.jl"/><meta name="description" content="Documentation for Fleck.jl."/><meta property="og:description" content="Documentation for Fleck.jl."/><meta property="twitter:description" content="Documentation for Fleck.jl."/><meta property="og:url" content="https://adolgert.github.io/Fleck.jl/hierarchical/"/><meta property="twitter:url" content="https://adolgert.github.io/Fleck.jl/hierarchical/"/><link rel="canonical" href="https://adolgert.github.io/Fleck.jl/hierarchical/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Fleck.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Guide</span><ul><li><a class="tocitem" href="../guide/">Competing Clocks</a></li><li><a class="tocitem" href="../mainloop/">Sample Main Loop</a></li><li><a class="tocitem" href="../distributions/">Non-exponential Simulation</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../distrib/">Notation for Distributions</a></li><li><a class="tocitem" href="../background/">Markov Processes</a></li><li><a class="tocitem" href="../gsmp/">GSMP</a></li><li><a class="tocitem" href="../samplers/">Understanding Samplers</a></li><li class="is-active"><a class="tocitem" href>Hierarchical Samplers</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Why-Hierarchical-Samplers"><span>Why Hierarchical Samplers</span></a></li><li><a class="tocitem" href="#First-Sampler-to-Fire"><span>First Sampler to Fire</span></a></li><li><a class="tocitem" href="#Multiple-Direct-Samplers"><span>Multiple Direct Samplers</span></a></li><li><a class="tocitem" href="#How-to-Split-a-Simulation"><span>How to Split a Simulation</span></a></li></ul></li><li><a class="tocitem" href="../memory/">Transitions with Memory</a></li><li><a class="tocitem" href="../commonrandom/">Common Random Numbers</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../constant_birth/">Birth-death Process</a></li><li><a class="tocitem" href="../sir/">SIR Model</a></li><li><a class="tocitem" href="../reliability/">Reliability</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../interface/">Interface</a></li><li><a class="tocitem" href="../reference/">Samplers</a></li><li><a class="tocitem" href="../algorithms/">Algorithms</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Hierarchical Samplers</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Hierarchical Samplers</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/adolgert/Fleck.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/adolgert/Fleck.jl/blob/main/docs/src/hierarchical.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Hierarchical-Samplers"><a class="docs-heading-anchor" href="#Hierarchical-Samplers">Hierarchical Samplers</a><a id="Hierarchical-Samplers-1"></a><a class="docs-heading-anchor-permalink" href="#Hierarchical-Samplers" title="Permalink"></a></h1><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>Continuous-time samplers have to process each event separately. As simulations grow in size, samplers use more memory, and they take more time to select the next event. One approach to speed up sampling is to use multiple samplers arranged in a hierarchy.</p><h2 id="Why-Hierarchical-Samplers"><a class="docs-heading-anchor" href="#Why-Hierarchical-Samplers">Why Hierarchical Samplers</a><a id="Why-Hierarchical-Samplers-1"></a><a class="docs-heading-anchor-permalink" href="#Why-Hierarchical-Samplers" title="Permalink"></a></h2><p>There are two reasons to use hierarchical samplers.</p><p>Some samplers are better for some simulations. If all transitions are Exponentially-distributed, then an optimized Direct sampler can be the fastest. If all of the distributions are of Exponential families, then Anderson&#39;s method is faster than the Next Reaction method. You can split the events among samplers according to the sampler that best fits the behavior of those events.</p><p>The other reason to use multiple samplers has to do with the frequency and locality of the events, in the same way we think of the frequency and locality of memory accesses for cache use. If there is a small subset of events that regenerate frequently, it can make sense even to use a <a href="../reference/#Fleck.FirstReaction"><code>FirstReaction</code></a> sampler for those events. While FirstReaction doesn&#39;t use a complicated data structure to optimize, it can be winningly fast for small numbers of events. Or, for a spatial simulation, you could make separate samplers for separate parts of the landscape, so that each event tends to affect a limited number of samplers.</p><h2 id="First-Sampler-to-Fire"><a class="docs-heading-anchor" href="#First-Sampler-to-Fire">First Sampler to Fire</a><a id="First-Sampler-to-Fire-1"></a><a class="docs-heading-anchor-permalink" href="#First-Sampler-to-Fire" title="Permalink"></a></h2><p>All of the different samplers find the first event to fire. If we set up two samplers, so that each holds mutually distinct enabled event distributions, we can ask each sampler which it thinks will fire next. The first to fire is the first of the two samplers. This generalizes to any number of samplers. We can make a <a href="../reference/#Fleck.MultiSampler"><code>MultiSampler</code></a> which contains multiple samplers and always returns the soonest of those contained.</p><p>Even further a MultiSampler can contain a MultiSampler if that makes sense.</p><h2 id="Multiple-Direct-Samplers"><a class="docs-heading-anchor" href="#Multiple-Direct-Samplers">Multiple Direct Samplers</a><a id="Multiple-Direct-Samplers-1"></a><a class="docs-heading-anchor-permalink" href="#Multiple-Direct-Samplers" title="Permalink"></a></h2><p>It&#39;s possible to make a Direct-style sampler that is hierarchical, too. A Direct sampler works in two steps. It sums the hazards of all enabled events and then selects a time according to the sum of the hazards. The main algorithm of a Direct sampler is to sum hazards. A hierarchical Direct algorithm sums the sums of the hazards and then selects a time.</p><p>While hierarchical samplers can contain multiple-Direct samplers, multiple-Direct samplers can only contain other multiple-Direct samplers.</p><h2 id="How-to-Split-a-Simulation"><a class="docs-heading-anchor" href="#How-to-Split-a-Simulation">How to Split a Simulation</a><a id="How-to-Split-a-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-Split-a-Simulation" title="Permalink"></a></h2><p>Each time a simulation calls <code>enable!</code> and <code>disable!</code> for an event, it specifies a key for that event. If the sampler is hierarchical, it can use that key, and maybe the type of the distribution, to choose which sampler handles any given event.</p><p>Fleck&#39;s approach in the <a href="../reference/#Fleck.MultiSampler"><code>MultiSampler</code></a> type is to let the user specify a function that takes as input the key and the distribution and returns some ID for the chosen sampler. The MultiSampler then remembers that choice for this event key, from that point on.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../samplers/">« Understanding Samplers</a><a class="docs-footer-nextpage" href="../memory/">Transitions with Memory »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Wednesday 29 May 2024 12:28">Wednesday 29 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
