<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Non-exponential Simulation · Fleck.jl</title><meta name="title" content="Non-exponential Simulation · Fleck.jl"/><meta property="og:title" content="Non-exponential Simulation · Fleck.jl"/><meta property="twitter:title" content="Non-exponential Simulation · Fleck.jl"/><meta name="description" content="Documentation for Fleck.jl."/><meta property="og:description" content="Documentation for Fleck.jl."/><meta property="twitter:description" content="Documentation for Fleck.jl."/><meta property="og:url" content="https://adolgert.github.io/Fleck.jl/distributions/"/><meta property="twitter:url" content="https://adolgert.github.io/Fleck.jl/distributions/"/><link rel="canonical" href="https://adolgert.github.io/Fleck.jl/distributions/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Fleck.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Guide</span><ul><li><a class="tocitem" href="../guide/">Competing Clocks</a></li><li><a class="tocitem" href="../mainloop/">Sample Main Loop</a></li><li class="is-active"><a class="tocitem" href>Non-exponential Simulation</a><ul class="internal"><li><a class="tocitem" href="#Distributions-in-Time"><span>Distributions in Time</span></a></li><li><a class="tocitem" href="#Competition"><span>Competition</span></a></li><li><a class="tocitem" href="#Specification-of-a-Simulation"><span>Specification of a Simulation</span></a></li></ul></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../distrib/">Notation for Distributions</a></li><li><a class="tocitem" href="../background/">Markov Processes</a></li><li><a class="tocitem" href="../gsmp/">GSMP</a></li><li><a class="tocitem" href="../samplers/">Understanding Samplers</a></li><li><a class="tocitem" href="../hierarchical/">Hierarchical Samplers</a></li><li><a class="tocitem" href="../memory/">Transitions with Memory</a></li><li><a class="tocitem" href="../commonrandom/">Common Random Numbers</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../constant_birth/">Birth-death Process</a></li><li><a class="tocitem" href="../sir/">SIR Model</a></li><li><a class="tocitem" href="../reliability/">Reliability</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../interface/">Interface</a></li><li><a class="tocitem" href="../reference/">Samplers</a></li><li><a class="tocitem" href="../algorithms/">Algorithms</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Guide</a></li><li class="is-active"><a href>Non-exponential Simulation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Non-exponential Simulation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/adolgert/Fleck.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/adolgert/Fleck.jl/blob/main/docs/src/distributions.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Non-exponential-Simulation"><a class="docs-heading-anchor" href="#Non-exponential-Simulation">Non-exponential Simulation</a><a id="Non-exponential-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Non-exponential-Simulation" title="Permalink"></a></h1><p>Fleck is a sampler for generalized semi-Markov processes (GSMP). Every event in a generalized semi-Markov process is chosen as the result of a competion among clocks to see which fires next.</p><p>In a <em>process-oriented</em> simulation (like <a href="https://simjuliajl.readthedocs.io/en/stable/welcome.html">SimJulia</a>), control flow is based on tasks. Each task performs some action on the state, rolls the dice, and sets a wake-up time. It might wake up as expected and possible execute code, or it might be interrupted by another task&#39;s actions. In contrast, an <em>event-oriented</em> simulation using Fleck will create a set of possible next events, assign a probability distribution for <em>when</em> each can happen, and the timing of which happens first determines <em>which</em> next event happens. Let&#39;s look at how a probability distribution describes the time for an event to happen and then how they compete in Fleck.</p><h2 id="Distributions-in-Time"><a class="docs-heading-anchor" href="#Distributions-in-Time">Distributions in Time</a><a id="Distributions-in-Time-1"></a><a class="docs-heading-anchor-permalink" href="#Distributions-in-Time" title="Permalink"></a></h2><p>Let&#39;s say you have a cold. You know you aren&#39;t going to recover immediately, but, as days go by, you&#39;re more and more sure you&#39;ll recover soon. This graph below shows recovery as a <em>hazard rate, which is the probability, per unit time, given that the event has not yet happened.</em></p><p><img src="../literate/distributions-5.png" alt/></p><p>This hazard rate starts at zero, meaning there&#39;s no way you&#39;ll recover when you&#39;re first sick. It gets more likely over time that you&#39;re at the tail end of being sick. The hazard rate shown is that of a Gamma distribution, commonly used to describe the rate of recovery for a population of individuals who are sick.</p><p>If, instead, you want to see the number of people who recover on any given day, that is called a probability distribution function (pdf), which is a much more common way to display a distribution in time.</p><p><img src="../literate/distributions-7.png" alt/></p><p>Where the hazard rate is an instantaneous quantity at a point in time, the probability distribution function (pdf) integrates over all possible future times. If we call the hazard rate <span>$\lambda(t)$</span> and call the pdf <span>$f(t)$</span>, we get this relationship.</p><p class="math-container">\[f(t) = \lambda(t) e^{-\int_0^t \lambda(s)ds}\]</p><p>The graph of the pdf tells us that the most likely time for this event is a little before time 5, in whatever units. You will see graphs of <a href="https://en.wikipedia.org/wiki/Gamma_distribution#/media/File:Gamma_distribution_pdf.svg">pdfs on Wikipedia</a> because this is how people usually think about the probability an event happens at some time.</p><p>A simulation, however, has multiple events possible at any one time. One event may happen, and then other events need to restart. Let&#39;s ask, if you still have a cold on day 5, what is the probability distribution function for when you will recover?</p><p><img src="../literate/distributions-9.png" alt/></p><p>The probability distribution function changes now that you know you didn&#39;t recover earlier than day 5. On the other hand, the hazard rate for recovery from the cold will be unchanged. Using the same hazard rate, we can recalculate the pdf from the new time <span>$t_0=5$</span>.</p><p class="math-container">\[f(t;t&gt;t_0) = \lambda(t) e^{-\int_{t_0}^t \lambda(s)ds}\]</p><p>The hazard rate describes a flow of probability, whereas the distribution function tells us about ensembles of events.</p><p>The hazard rate is related to the well known cumulative distribution function (CDF) by an integral. The CDF tells us what is the overall probability the event occured some time in the interval <span>$[t_0,t_1)$</span>.</p><p class="math-container">\[F(t_0;t_1) = 1 - e^{-\int_{t_0}^{t_1} \lambda(s) ds}\]</p><p>Equally important for simulation is the survival function (sometimes called the complementary cumulative distribution function), which is the probability the event will not occur until after <span>$t_1$</span>.</p><p class="math-container">\[S(t_1) = 1 - F(t_1;0) = e^{-\int_{0}^{t_1} \lambda(s) ds}\]</p><p><img src="../literate/distributions-11.png" alt/></p><p>For our example, survival is the chance the cold lasts longer than the given time.</p><h2 id="Competition"><a class="docs-heading-anchor" href="#Competition">Competition</a><a id="Competition-1"></a><a class="docs-heading-anchor-permalink" href="#Competition" title="Permalink"></a></h2><h3 id="Individual-Distributions"><a class="docs-heading-anchor" href="#Individual-Distributions">Individual Distributions</a><a id="Individual-Distributions-1"></a><a class="docs-heading-anchor-permalink" href="#Individual-Distributions" title="Permalink"></a></h3><p>Let&#39;s think of a moment when there are three possible next events. There is a Gamma distribution for when you recover from a cold, a Weibull distribution for when you decide to take medicine for the cold, and an Exponential distribution for when your Mom calls you. Each one is described by a distribution in time, and we can think of them as three hazard rates.</p><p><img src="../literate/distributions-14.png" alt/></p><p>The separate hazard rates are what we put into the simulation. Given their competition, the hazard rates will remain unchanged, but the pdfs will change.</p><h3 id="Marginal-Probability"><a class="docs-heading-anchor" href="#Marginal-Probability">Marginal Probability</a><a id="Marginal-Probability-1"></a><a class="docs-heading-anchor-permalink" href="#Marginal-Probability" title="Permalink"></a></h3><p>Each of the three clock distributions above corresponds to a unique event <span>$E_i$</span>, which has a probability that it will be the first to fire. We calculate this probability by marginalizing over the other events, which ends up being an integral over the distribution, multiplied by the survivals of the other events.</p><p class="math-container">\[P[E_i] = \int_0^\infty f_i(t) \prod_{j\ne i} S_j(t) dt\]</p><p>That gives the chart on the left, where the sum of all <span>$P[E_i]$</span> is one.</p><p><img src="../literate/distributions-16.png" alt/></p><p>The graph on the right shows the conditional distribution in time for each event, given that it was the one that fired, so it is <span>$P[t_i | E_i]$</span>. In the language of semi-Markov processes, these distributions are called <em>holding times.</em> You can see that these distributions don&#39;t match the distributions for the individual events. They are modified by competition.</p><h3 id="Marginal-Time"><a class="docs-heading-anchor" href="#Marginal-Time">Marginal Time</a><a id="Marginal-Time-1"></a><a class="docs-heading-anchor-permalink" href="#Marginal-Time" title="Permalink"></a></h3><p>What if we split the marginal and conditional the other way? Instead of marginalizing the probability of which event fires, start with a marginal of the probability for when any event fires. One way to calculate this is to say that the hazard rate for any event to fire is the sum of the hazard rates.</p><p class="math-container">\[\lambda_m(t) = \sum_i\lambda_i(t)\]</p><p>From here, we know the pdf for the first firing time.</p><p class="math-container">\[f(t) = \lambda_m(t)\exp\left(-\int_0^t\lambda_m(s)ds\right)\]</p><p>From the graph above, if we pick a time, <span>$t_1=10$</span>, we can read from the graph three hazard rates, <span>$(\lambda_1(t_1),\lambda_2(t_1), \lambda_3(t_1))$</span>. Each hazard rate is the rate, per unit time, of that event. We know that, if the simulation makes it to <span>$t=10$</span> without any event happening, the conditional probability for any one of those events is the ratio of hazard rates.</p><p class="math-container">\[P[E_1|t=t_1] = \frac{\lambda_1(t_1)}{\lambda_1(t_1)+\lambda_2(t_1)+\lambda_3(t_1)}\]</p><p>Now we can plot, on the left, the pdf for who fires first and, on the right, the probability of which event fires, given the firing time.</p><p><img src="../literate/distributions-18.png" alt/></p><p>On the left of this graph is the pdf for the first event of the three to fire. We can see this as a marginal <span>$P[t]$</span> and then the right-hand graph as the conditional <span>$P[E_i|t]$</span>.</p><h2 id="Specification-of-a-Simulation"><a class="docs-heading-anchor" href="#Specification-of-a-Simulation">Specification of a Simulation</a><a id="Specification-of-a-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Specification-of-a-Simulation" title="Permalink"></a></h2><p>If we imagine a drug trial, where patients can recover, die, or exit the trial for some other reason, there are three mutually-exclusive events, like the example above. If we pick the recovery event and plot its distribution in time, which of the above plots will we see? This will be a holding time. It won&#39;t be the pdf that represents the rate of recovery in the absence of competing events. However, given observations of competing events, it is possible to calculate back to the original hazard rates using survival analysis.</p><p><a href="https://en.wikipedia.org/wiki/Survival_analysis">Survival analysis</a> uses observations of event times and event cancellations to estimate hazard rates for each event. It helps you tease apart the effects of competition to see the underlying probability per unit time that any event would fire, given that it has not yet fired.</p><p>Simulation is the opposite of survival analysis. It allows you to take rules for how any event would fire, in the absence of competition, and to place it in a more complicated environment where competition happens. When you specify a continuous-time simulation, it isn&#39;t specified with the pdfs of holding times but with the pdfs of rates derived from survival analysis.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../mainloop/">« Sample Main Loop</a><a class="docs-footer-nextpage" href="../distrib/">Notation for Distributions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Wednesday 29 May 2024 11:54">Wednesday 29 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
