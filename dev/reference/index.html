<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Samplers · CompetingClocks.jl Documentation</title><meta name="title" content="Samplers · CompetingClocks.jl Documentation"/><meta property="og:title" content="Samplers · CompetingClocks.jl Documentation"/><meta property="twitter:title" content="Samplers · CompetingClocks.jl Documentation"/><meta name="description" content="Documentation for CompetingClocks.jl Documentation."/><meta property="og:description" content="Documentation for CompetingClocks.jl Documentation."/><meta property="twitter:description" content="Documentation for CompetingClocks.jl Documentation."/><meta property="og:url" content="https://adolgert.github.io/CompetingClocks.jl/reference/"/><meta property="twitter:url" content="https://adolgert.github.io/CompetingClocks.jl/reference/"/><link rel="canonical" href="https://adolgert.github.io/CompetingClocks.jl/reference/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">CompetingClocks.jl Documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../install/">Installation</a></li><li><a class="tocitem" href="../quickstart/">Quickstart</a></li><li><a class="tocitem" href="../mainloop/">Sample Main Loop</a></li><li><a class="tocitem" href="../choosing_sampler/">Choosing a Sampler</a></li></ul></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../integration-guide/">Integration Guide</a></li><li><a class="tocitem" href="../low_level_interface/">Low-level Sampler Interface</a></li><li><a class="tocitem" href="../samplers/">Understanding Samplers</a></li><li><a class="tocitem" href="../delayed/">Delayed Clocks</a></li><li><a class="tocitem" href="../guide/">Competing Clocks</a></li><li><a class="tocitem" href="../distributions/">Non-exponential Simulation</a></li><li><a class="tocitem" href="../hierarchical/">Hierarchical Samplers</a></li><li><a class="tocitem" href="../debugging/">Debugging a Simulation that Uses CompetingClocks</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../reliability/">Reliability</a></li><li><a class="tocitem" href="../sir/">SIR Model</a></li><li><a class="tocitem" href="../constant_birth/">Birth-death Process</a></li><li><a class="tocitem" href="../memory/">Transitions with Memory</a></li><li><a class="tocitem" href="../gene_expression/">Gene Expression</a></li></ul></li><li><span class="tocitem">Statistical Methods</span><ul><li><a class="tocitem" href="../commonrandom/">Common Random Numbers</a></li><li><a class="tocitem" href="../importance_skills/">Importance Sampling for Simulation</a></li><li><a class="tocitem" href="../hamiltonianmontecarlo/">Hamiltonian Monte Carlo</a></li><li><input class="collapse-toggle" id="menuitem-5-4" type="checkbox"/><label class="tocitem" for="menuitem-5-4"><span class="docs-label">Gen.jl Integration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../gen/overview/">Gen.jl and CompetingClocks.jl</a></li><li><a class="tocitem" href="../gen/distribution/">CompetingClocks as a Gen Distribution</a></li><li><a class="tocitem" href="../gen/generative_function/">CompetingClocks as a Gen Generative Function</a></li><li><a class="tocitem" href="../gen/observation_likelihood/">Observation Likelihood for Event Data</a></li><li><a class="tocitem" href="../gen/importance_mixture/">Importance Sampling with Mixture Proposals</a></li><li><a class="tocitem" href="../gen/hmc_paths/">HMC over Event Paths with Gen.jl</a></li></ul></li><li><a class="tocitem" href="../gen/turing_dist/">Bayesian Inference with Turing.jl</a></li><li><a class="tocitem" href="../gen/survival_snippet/">Integration with Survival.jl</a></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../contextinterface/">Context Interface</a></li><li class="is-active"><a class="tocitem" href>Samplers</a><ul class="internal"><li><a class="tocitem" href="#Sampling-Helpers"><span>Sampling Helpers</span></a></li></ul></li><li><a class="tocitem" href="../algorithms/">Algorithms</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">API Reference</a></li><li class="is-active"><a href>Samplers</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Samplers</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/adolgert/CompetingClocks.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/adolgert/CompetingClocks.jl/blob/main/docs/src/reference.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Samplers"><a class="docs-heading-anchor" href="#Samplers">Samplers</a><a id="Samplers-1"></a><a class="docs-heading-anchor-permalink" href="#Samplers" title="Permalink"></a></h1><p>The choice of sampler determines specific algorithms that are used to sample, update, and disable clocks. Helpers also exist that are useful for logging, utilizing common random numbers, and hierarchical sampling.</p><h2 id="Sampling-Helpers"><a class="docs-heading-anchor" href="#Sampling-Helpers">Sampling Helpers</a><a id="Sampling-Helpers-1"></a><a class="docs-heading-anchor-permalink" href="#Sampling-Helpers" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="CompetingClocks.CommonRandom"><a class="docstring-binding" href="#CompetingClocks.CommonRandom"><code>CompetingClocks.CommonRandom</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Continuation/Functional Pattern</p><p>Key Insight: CommonRandom provides RNG transformation as a higher-order function.</p><p>struct CommonRandom{K,R}       recorder::Dict{K,Vector{R}}       mode::Symbol   end</p><p>function with<em>common</em>rng(       crc::CommonRandom{K,R}, clock::K, base<em>rng::R, f::Function   ) where {K,R}       # Determine which RNG to use       if crc.mode == :replaying &amp;&amp; haskey(crc.recorder, clock)           # ... retrieve saved RNG ...           active</em>rng = saved<em>rng       else           active</em>rng = copy(base_rng)           if crc.mode == :recording               # ... save RNG snapshot ...           end       end</p><pre><code class="language-julia hljs">  # Call continuation with prepared RNG
  return f(active_rng)</code></pre><p>end</p><p>function enable!(ctx::SamplingContext, clock, dist, te, when)       if ctx.common<em>random !== nothing           # Wrap sampler call in RNG transformation           with</em>common<em>rng(ctx.common</em>random, clock, ctx.rng) do rng               enable!(ctx.sampler, clock, dist, te, when, rng)           end       else           enable!(ctx.sampler, clock, dist, te, when, ctx.rng)       end</p><pre><code class="language-julia hljs">  # Other components use base RNG
  ctx.likelihood !== nothing &amp;&amp; enable!(ctx.likelihood, clock, dist, te, when, ctx.rng)
  ctx.debug !== nothing &amp;&amp; enable!(ctx.debug, clock, dist, te, when, ctx.rng)</code></pre><p>end</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/adolgert/CompetingClocks.jl/blob/504693648bb84a357fc0c04b82eaea2f9594201d/src/variance/with_common_random.jl#L3-L45">source</a></section></details></article><article><details class="docstring" open="true"><summary id="CompetingClocks.freeze_crn!"><a class="docstring-binding" href="#CompetingClocks.freeze_crn!"><code>CompetingClocks.freeze_crn!</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Call this before replaying common random numbers. Call it before each replay.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/adolgert/CompetingClocks.jl/blob/504693648bb84a357fc0c04b82eaea2f9594201d/src/variance/with_common_random.jl#L86-L89">source</a></section><section><div><pre><code class="language-julia hljs">freeze_crn!(ctx::SamplingContext)</code></pre><p>Switch to using only previously recorded common random numbers.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/adolgert/CompetingClocks.jl/blob/504693648bb84a357fc0c04b82eaea2f9594201d/src/context.jl#L133-L137">source</a></section></details></article><article><details class="docstring" open="true"><summary id="CompetingClocks.reset_crn!"><a class="docstring-binding" href="#CompetingClocks.reset_crn!"><code>CompetingClocks.reset_crn!</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">reset_crn!(ctx::SamplingContext)</code></pre><p>Reset stored CRN draws and time.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/adolgert/CompetingClocks.jl/blob/504693648bb84a357fc0c04b82eaea2f9594201d/src/context.jl#L148-L152">source</a></section></details></article><article><details class="docstring" open="true"><summary id="CompetingClocks.split!"><a class="docstring-binding" href="#CompetingClocks.split!"><code>CompetingClocks.split!</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">split!(dst, src)</code></pre><p>Split a <code>src</code> context into multiple copies in <code>dst</code>, adjusting <code>split_weight</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/adolgert/CompetingClocks.jl/blob/504693648bb84a357fc0c04b82eaea2f9594201d/src/context.jl#L548-L552">source</a></section></details></article><article><details class="docstring" open="true"><summary id="CompetingClocks.misscount"><a class="docstring-binding" href="#CompetingClocks.misscount"><code>CompetingClocks.misscount</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>How many times the sampler looked for a random number and found no previous value.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/adolgert/CompetingClocks.jl/blob/504693648bb84a357fc0c04b82eaea2f9594201d/src/variance/with_common_random.jl#L78-L80">source</a></section></details></article><article><details class="docstring" open="true"><summary id="CompetingClocks.misses"><a class="docstring-binding" href="#CompetingClocks.misses"><code>CompetingClocks.misses</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>The Pairs of clock keys and values that weren&#39;t found.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/adolgert/CompetingClocks.jl/blob/504693648bb84a357fc0c04b82eaea2f9594201d/src/variance/with_common_random.jl#L82-L84">source</a></section></details></article><article><details class="docstring" open="true"><summary id="CompetingClocks.consume_survival"><a class="docstring-binding" href="#CompetingClocks.consume_survival"><code>CompetingClocks.consume_survival</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>This updates the survival for a transition in the linear space, according to Gibson and Bruck. Transition was enabled between time record t<em>0 and t</em>n. Divide the survival by the conditional survival between t<em>0 and t</em>n. t<em>e can be before t</em>0, at t<em>0, between t</em>0 and t<em>n, or at t</em>n, or after t_n.</p><p><span>$u=\exp\left(-\int_{t_e}^{t_n}\lambda_0(s-t_e)ds\right)\exp\left(-\int_{t_n}^{\tau&#39;}\lambda_{n}(s-t_e)ds\right)$</span></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/adolgert/CompetingClocks.jl/blob/504693648bb84a357fc0c04b82eaea2f9594201d/src/sample/combinednr.jl#L246-L255">source</a></section><section><div><p>This updates the survival for a transition in log space, according to Anderson&#39;s method.</p><p><span>$\ln u=-\int_{t_e}^{t_n}\lambda_0(s-t_e)ds - \int_{t_n}^{\tau&#39;}\lambda_{n}(s-t_e)ds$</span></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/adolgert/CompetingClocks.jl/blob/504693648bb84a357fc0c04b82eaea2f9594201d/src/sample/combinednr.jl#L273-L279">source</a></section></details></article><article><details class="docstring" open="true"><summary id="CompetingClocks.sampling_space"><a class="docstring-binding" href="#CompetingClocks.sampling_space"><code>CompetingClocks.sampling_space</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>This function decides whether a particular distribution can be sampled faster and more accurately using its cumulative distribution function or using the log of its cumulative distribution function, also called the integrated hazard. The former is used for the Next Reaction method by Gibson and Bruck. The latter is used by the Modified Next Reaction method of Anderson. We are calling the first a linear space and the second a logarithmic space.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/adolgert/CompetingClocks.jl/blob/504693648bb84a357fc0c04b82eaea2f9594201d/src/sample/combinednr.jl#L7-L14">source</a></section></details></article><article><details class="docstring" open="true"><summary id="CompetingClocks.steploglikelihood"><a class="docstring-binding" href="#CompetingClocks.steploglikelihood"><code>CompetingClocks.steploglikelihood</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">steploglikelihood(tw::TrackWatcher, now, when_fires, which_fires)</code></pre><p>Calculate the log probability density of a single step in which the <code>which_fires</code> transition fires next. <code>now</code> is the current time. <code>when_fires</code> is the time when <code>which_fires</code> happens so <code>when &gt; now</code>. You have to call this before the transition fires so that it is before transitions are enabled and disabled from the previous step.</p><p>One way to compute a marginal likelihood of a particular clock firing <span>$P[K]$</span> is to integrate:</p><pre><code class="language-julia hljs">Using QuadGK
quadgk(t -&gt; exp(steploglikelihood(tw, t0, t, clock)), t0, Inf)[1]</code></pre><p>It would be slow but could be done.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/adolgert/CompetingClocks.jl/blob/504693648bb84a357fc0c04b82eaea2f9594201d/src/trace/track.jl#L138-L153">source</a></section><section><div><pre><code class="language-julia hljs">steploglikelihood(ctx, when, which)</code></pre><p>Step log-likelihood of an event <code>which</code> at <code>when</code>. For delayed contexts, <code>which</code> should be the internal key (e.g. <code>(clock, phase)</code>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/adolgert/CompetingClocks.jl/blob/504693648bb84a357fc0c04b82eaea2f9594201d/src/context.jl#L622-L627">source</a></section></details></article><article><details class="docstring" open="true"><summary id="CompetingClocks.FromInclusion"><a class="docstring-binding" href="#CompetingClocks.FromInclusion"><code>CompetingClocks.FromInclusion</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>See sampler.jl for the MultiSampler to understand how we&#39;re making a chooser. We would like to implement this: &quot;Compiling Pattern Matching to Good Decision Trees&quot; - Luc Maranget (2008). It looks like MLStyle.jl has a good example of how to do it.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/adolgert/CompetingClocks.jl/blob/504693648bb84a357fc0c04b82eaea2f9594201d/src/sampler_builder.jl#L111-L116">source</a></section></details></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../contextinterface/">« Context Interface</a><a class="docs-footer-nextpage" href="../algorithms/">Algorithms »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Friday 28 November 2025 20:25">Friday 28 November 2025</span>. Using Julia version 1.12.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
