<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Delayed Clocks · CompetingClocks.jl Documentation</title><meta name="title" content="Delayed Clocks · CompetingClocks.jl Documentation"/><meta property="og:title" content="Delayed Clocks · CompetingClocks.jl Documentation"/><meta property="twitter:title" content="Delayed Clocks · CompetingClocks.jl Documentation"/><meta name="description" content="Documentation for CompetingClocks.jl Documentation."/><meta property="og:description" content="Documentation for CompetingClocks.jl Documentation."/><meta property="twitter:description" content="Documentation for CompetingClocks.jl Documentation."/><meta property="og:url" content="https://adolgert.github.io/CompetingClocks.jl/delayed/"/><meta property="twitter:url" content="https://adolgert.github.io/CompetingClocks.jl/delayed/"/><link rel="canonical" href="https://adolgert.github.io/CompetingClocks.jl/delayed/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">CompetingClocks.jl Documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../install/">Installation</a></li><li><a class="tocitem" href="../quickstart/">Quickstart</a></li><li><a class="tocitem" href="../mainloop/">Sample Main Loop</a></li><li><a class="tocitem" href="../choosing_sampler/">Choosing a Sampler</a></li></ul></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../integration-guide/">Integration Guide</a></li><li><a class="tocitem" href="../low_level_interface/">Low-level Sampler Interface</a></li><li><a class="tocitem" href="../samplers/">Understanding Samplers</a></li><li class="is-active"><a class="tocitem" href>Delayed Clocks</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Sampling-a-Delayed-Clock"><span>Sampling a Delayed Clock</span></a></li><li><a class="tocitem" href="#Compatibility"><span>Compatibility</span></a></li></ul></li><li><a class="tocitem" href="../guide/">Competing Clocks</a></li><li><a class="tocitem" href="../distributions/">Non-exponential Simulation</a></li><li><a class="tocitem" href="../hierarchical/">Hierarchical Samplers</a></li><li><a class="tocitem" href="../debugging/">Debugging a Simulation that Uses CompetingClocks</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../reliability/">Reliability</a></li><li><a class="tocitem" href="../sir/">SIR Model</a></li><li><a class="tocitem" href="../constant_birth/">Birth-death Process</a></li><li><a class="tocitem" href="../memory/">Transitions with Memory</a></li><li><a class="tocitem" href="../gene_expression/">Gene Expression</a></li></ul></li><li><span class="tocitem">Statistical Methods</span><ul><li><a class="tocitem" href="../commonrandom/">Common Random Numbers</a></li><li><a class="tocitem" href="../importance_skills/">Importance Sampling for Simulation</a></li><li><a class="tocitem" href="../hamiltonianmontecarlo/">Hamiltonian Monte Carlo</a></li><li><input class="collapse-toggle" id="menuitem-5-4" type="checkbox"/><label class="tocitem" for="menuitem-5-4"><span class="docs-label">Gen.jl Integration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../gen/overview/">Gen.jl and CompetingClocks.jl</a></li><li><a class="tocitem" href="../gen/distribution/">CompetingClocks as a Gen Distribution</a></li><li><a class="tocitem" href="../gen/generative_function/">CompetingClocks as a Gen Generative Function</a></li><li><a class="tocitem" href="../gen/observation_likelihood/">Observation Likelihood for Event Data</a></li><li><a class="tocitem" href="../gen/importance_mixture/">Importance Sampling with Mixture Proposals</a></li><li><a class="tocitem" href="../gen/hmc_paths/">HMC over Event Paths with Gen.jl</a></li></ul></li><li><a class="tocitem" href="../gen/turing_dist/">Bayesian Inference with Turing.jl</a></li><li><a class="tocitem" href="../gen/survival_snippet/">Integration with Survival.jl</a></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../contextinterface/">Context Interface</a></li><li><a class="tocitem" href="../reference/">Samplers</a></li><li><a class="tocitem" href="../algorithms/">Algorithms</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User Guide</a></li><li class="is-active"><a href>Delayed Clocks</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Delayed Clocks</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/adolgert/CompetingClocks.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/adolgert/CompetingClocks.jl/blob/main/docs/src/delayed.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Delayed-Clocks"><a class="docs-heading-anchor" href="#Delayed-Clocks">Delayed Clocks</a><a id="Delayed-Clocks-1"></a><a class="docs-heading-anchor-permalink" href="#Delayed-Clocks" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>There are common uses for delayed clocks, also called delayed reactions.</p><ol><li>State-independent uninterruptible delay: a susceptible-infectious-recovered (SIR) model where the I to R transition occurs after some fixed duration <span>$\tau$</span>.</li><li>State-independent delay with state-independent interruption: consider the SIR model of type 1, but where there is an additional transition from I to death, with constant per-capita hazard <span>$\mu$</span>. Then the I to R transition may be interrupted by death with probability <span>$1-e^{-\mu\tau}$</span>, which is known at initiation of the delay clock.</li><li>State-independent delay with state-dependent interruption: from the example of [3], consider a predator (<span>$X$</span>) prey (<span>$Y$</span>) model (including the events birth of prey, predation, and death of predators). Now assume that when prey give birth the juvenile prey requires time <span>$\tau$</span> before becoming an adult. Also assume that juveniles are subject to predation, so they have a per-capita hazard of <span>$\beta X$</span>. Because the rate of predation upon juveniles is a function of state <span>$X$</span> which may change before completion of the maturation phase <span>$\tau$</span> due to other events, probability of interruption is not known at initiation.</li><li>State-dependent uninterruptible delay: Consider a model where larvae compete for resources, so that the duration of time <span>$\tau(X)$</span> required for maturation is explicitly a function of the state <span>$X$</span>, but that the larval stage is invulnerable to death, and so cannot be interrupted. An example is the damselfly model of [4] without death.</li><li>State-dependent delay with state-independent interruption: Consider the damselfly model of [4]; a larvae&#39;s maturation delay <span>$\tau(X)$</span> depends on the density of other larvae as they compete for a resource, but maturing larvae also suffer constant per-capita mortality <span>$\mu$</span>.</li><li>State-dependent delay with state-dependent interruption: Consider complicating the damselfly model by making larval mortality state dependent, perhaps by introducing a predator class or cannibalism among the larvae.</li></ol><p>For sampling, this means we want to associate a clock with two distributions.</p><h2 id="Sampling-a-Delayed-Clock"><a class="docs-heading-anchor" href="#Sampling-a-Delayed-Clock">Sampling a Delayed Clock</a><a id="Sampling-a-Delayed-Clock-1"></a><a class="docs-heading-anchor-permalink" href="#Sampling-a-Delayed-Clock" title="Permalink"></a></h2><p>Create a sampler to support delays by passing the <code>support_delayed=true</code> flag. For example:</p><pre><code class="language-julia hljs">builder = SamplerBuilder(Symbol, Float64;
                         support_delayed=true,
                         method=FirstToFireMethod(),
                         common_random=true)
sampler = SamplingContext(builder, rng)</code></pre><p>Enable a delayed clock using a pair of distributions.</p><pre><code class="language-julia hljs">enable!(ctx, :recover, Exponential(0.5) =&gt; Dirac(5.0))</code></pre><p>The first is the time until the reaction starts and the second is the time from the start to the end. Either or both can be of fixed duration or have distributions in time.</p><p>In the regular main loop, instead of calling <code>next(sampler)</code>, call <code>next_delayed(sampler)</code>.</p><pre><code class="language-julia hljs">when, which, phase = next_delayed(sampler)</code></pre><p>The <code>phase</code> is one of three symbols.</p><ul><li><code>:regular</code> for clocks with no delays.</li><li><code>:initiate</code> for the first phase of a delayed clock.</li><li><code>:complete</code> for the second phase of a delayed clock.</li></ul><p>You can <code>delete!(sampler, clock)</code> at any time, and it will delete either the initial and final, or just the final phase. It deletes whatever is currently enabled for that clock.</p><p>When the main loop fires, it should specify which clock it&#39;s firing by adding the phase.</p><pre><code class="language-julia hljs">fire!(ctx, which, phase, when) </code></pre><p>The initial clock isn&#39;t hidden from the user because some simulations need to be notified when the initial clock fires.</p><h2 id="Compatibility"><a class="docs-heading-anchor" href="#Compatibility">Compatibility</a><a id="Compatibility-1"></a><a class="docs-heading-anchor-permalink" href="#Compatibility" title="Permalink"></a></h2><ul><li>Common random numbers and likelihoods are compatible with delayed clocks.</li><li>There isn&#39;t support for using arrays of distributions for vectorized importance sampling.</li><li>If you check for an enabled clock, you will see that its key includes the clock phase.</li></ul><pre><code class="nohighlight hljs"></code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../samplers/">« Understanding Samplers</a><a class="docs-footer-nextpage" href="../guide/">Competing Clocks »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Friday 28 November 2025 20:25">Friday 28 November 2025</span>. Using Julia version 1.12.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
