<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Markov Processes · Fleck.jl</title><meta name="title" content="Markov Processes · Fleck.jl"/><meta property="og:title" content="Markov Processes · Fleck.jl"/><meta property="twitter:title" content="Markov Processes · Fleck.jl"/><meta name="description" content="Documentation for Fleck.jl."/><meta property="og:description" content="Documentation for Fleck.jl."/><meta property="twitter:description" content="Documentation for Fleck.jl."/><meta property="og:url" content="https://adolgert.github.io/Fleck.jl/background/"/><meta property="twitter:url" content="https://adolgert.github.io/Fleck.jl/background/"/><link rel="canonical" href="https://adolgert.github.io/Fleck.jl/background/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Fleck.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Guide</span><ul><li><a class="tocitem" href="../guide/">Competing Clocks</a></li><li><a class="tocitem" href="../mainloop/">Sample Main Loop</a></li><li><a class="tocitem" href="../distributions/">Non-exponential Simulation</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../distrib/">Notation for Distributions</a></li><li class="is-active"><a class="tocitem" href>Markov Processes</a><ul class="internal"><li><a class="tocitem" href="#The-Hazard-from-Survival-Analysis"><span>The Hazard from Survival Analysis</span></a></li><li><a class="tocitem" href="#Finite-State-Machines-Generate-Trajectories"><span>Finite State Machines Generate Trajectories</span></a></li><li><a class="tocitem" href="#Markov-Chain-for-Discrete-Time-Trajectories"><span>Markov Chain for Discrete-Time Trajectories</span></a></li><li><a class="tocitem" href="#Markov-Process-for-Continuous-Time-Trajectories"><span>Markov Process for Continuous-Time Trajectories</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li><li><a class="tocitem" href="#Acknowledgement"><span>Acknowledgement</span></a></li></ul></li><li><a class="tocitem" href="../gsmp/">GSMP</a></li><li><a class="tocitem" href="../samplers/">Understanding Samplers</a></li><li><a class="tocitem" href="../hierarchical/">Hierarchical Samplers</a></li><li><a class="tocitem" href="../memory/">Transitions with Memory</a></li><li><a class="tocitem" href="../commonrandom/">Common Random Numbers</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../constant_birth/">Birth-death Process</a></li><li><a class="tocitem" href="../sir/">SIR Model</a></li><li><a class="tocitem" href="../reliability/">Reliability</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../interface/">Interface</a></li><li><a class="tocitem" href="../reference/">Samplers</a></li><li><a class="tocitem" href="../algorithms/">Algorithms</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Markov Processes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Markov Processes</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/adolgert/Fleck.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/adolgert/Fleck.jl/blob/main/docs/src/background.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Markov-Processes"><a class="docs-heading-anchor" href="#Markov-Processes">Markov Processes</a><a id="Markov-Processes-1"></a><a class="docs-heading-anchor-permalink" href="#Markov-Processes" title="Permalink"></a></h1><p>This addresses two main points, how to specify a model for the library using distributions defined by hazards and why such a specification, with its initial conditions, is sufficient to define the trajectory for a model.</p><h2 id="The-Hazard-from-Survival-Analysis"><a class="docs-heading-anchor" href="#The-Hazard-from-Survival-Analysis">The Hazard from Survival Analysis</a><a id="The-Hazard-from-Survival-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#The-Hazard-from-Survival-Analysis" title="Permalink"></a></h2><h3 id="Discrete-case"><a class="docs-heading-anchor" href="#Discrete-case">Discrete case</a><a id="Discrete-case-1"></a><a class="docs-heading-anchor-permalink" href="#Discrete-case" title="Permalink"></a></h3><p>The discrete case is much easier to understand than the continuous case because it can be explained without employing any results from calculus. Throughout this section, <span>$\bf{X}$</span> will be assumed to real-valued random variable. For example, <span>$\bf{X}$</span> could represent latent periods for measles.</p><p>It frequently happens that random samples of the real valued variables such as <span>$\bf{X}$</span> are actually analyzed on a discrete scale. For example Stocks&#39; data on latent periods of measles in <code>latent_period</code> is based on daily visits by patients [Stocks:1931].</p><p>The (cumulative) distribution of <span>$\bf{X}$</span> is defined as</p><p class="math-container">\[F_{X}(k) = \mathcal{P}[x \le k]\]</p><p>assuming <span>$F_{X}(\infty) = 1$</span>. The density can be expressed as the difference in adjacent values of the distribution</p><p class="math-container">\[\begin{aligned}
f_{X}(k) &amp; =  \mathcal{P}[X=k] \\
         &amp; =  \mathcal{P}[X\le k] - \mathcal{P}[X \le k-1 ] \\
     &amp; =  F_{X}(k) - F_{X}(k-1)
\end{aligned}\]</p><p>For Stocks&#39; data in <code>latent_period</code>, the density at day <span>$k$</span> should be interpreted as the probability of the appearance of symptoms since the previous visit on day <span>$k-1$</span>.</p><p>The <em>hazard</em> is defined as the conditional probability that the value of a random selection from <span>$\bf{X}$</span> equals <span>$k$</span> given it this value is already known to exceed <span>$k-1$</span>. Using the usual rules for computing conditional probabilities, the hazard is given by the following ratio</p><p class="math-container">\[\begin{aligned}
h_{X}(k) &amp; =  \mathcal{P}[X=k\; |\; k-1&lt;X] \\
         &amp; =  {\frac{f_{X}(k)}{1 - F_{X}(k-1)}}
\end{aligned}\]</p><p>In the case of Stocks&#39; data, the hazards shown in <code>latent_period_hazard</code> would correspond to the probability of symptoms appearing at day <span>$k$</span> given that the patient had not displayed symptoms at any previous visit. As time goes on, patients who have already developed symptoms effectively reduce the pool of patients in the study who are still in a state where they might first present symptoms on day <span>$k$</span>. This is the origin of the term in the denominator.</p><p><img src="../assets/Stocks_hazard.svg" alt="Figure 2. Estimated hazards of latent periods for measles in London circa 1931"/></p><p>On any given day, the hazard for latent periods can be interpreted as the rate of appearance of symptoms per asymptomatic (infected but not yet symptomatic) patient per day. For example, the hazard inferred from the Weibull distribution is approximately <span>$0.15$</span> on day 10. In other words, 15% of the patients that are asymptomatic on day 9 will present symptoms when examined on day 10.</p><p><img src="../assets/stocks_person.svg" alt="Figure 3. Each participant of the Stocks study could either become symptomatic or leave the study. Focusing on the hazard accounts for the effect of those who leave."/></p><p>This interpretation is extremely important because it connects a hazard with a rate for a specific process, and that rate has well defined units of measurement. In addition, it clarifies how rate parameters should be estimated from observational data. Failure to account for the shrinking pool over time is commonplace. In this case it would lead to a systematic errors in the estimation of process rates, especially at long times when the depletion effect is most pronounced.</p><h3 id="Continuous-case"><a class="docs-heading-anchor" href="#Continuous-case">Continuous case</a><a id="Continuous-case-1"></a><a class="docs-heading-anchor-permalink" href="#Continuous-case" title="Permalink"></a></h3><p>The random variable <span>$\bf{X}$</span> is again assumed to be a real-valued, but the measurements will not be binned as above. The cumulative distribution not an integer <span>$k$</span> but a continuous time interval, <span>$\tau$</span>.</p><p class="math-container">\[F_X(\tau)=P[x\le\tau]\]</p><p>assuming <span>$F_X(\infty)=1$</span>. The density is the derivative of the cumulative distribution. The concept of the hazard is part of survival analysis, where survival is <span>$G_X(\tau)=1-F_X(\tau)$</span>, and represents the probability the random variable, a time interval, is longer than <span>$\tau$</span>. One expression for the hazard is that the density of the random variable is equal to the probability it survives to a time <span>$\tau$</span> multiplied by the hazard rate for firing at time <span>$\tau$</span>, or, in probabilities,</p><p class="math-container">\[P[\tau&lt;x\le\tau+d\tau]d\tau=P[\tau&lt;x]P[\tau&lt;x\le\tau+d\tau+d\tau|\tau&lt;x].\]</p><p>Writing this same equation with its almost-sure equivalents defines the continuous hazard, <span>$\lambda_X(\tau)$</span>,</p><p class="math-container">\[f_X(\tau)=G_X(\tau)\lambda_X(\tau).\]</p><p>This is a rearrangement away from the definition of the discrete case.</p><h2 id="Finite-State-Machines-Generate-Trajectories"><a class="docs-heading-anchor" href="#Finite-State-Machines-Generate-Trajectories">Finite State Machines Generate Trajectories</a><a id="Finite-State-Machines-Generate-Trajectories-1"></a><a class="docs-heading-anchor-permalink" href="#Finite-State-Machines-Generate-Trajectories" title="Permalink"></a></h2><p>This library accepts a specification of a model in terms of hazards, an initial condition, and produces trajectories. This set of high-level steps to simulation (specify, initialize, step) has a well-defined abstraction called a <em>finite state machine.</em> It isn&#39;t the finite state machine familiar to programmers but a mathematical model, coming from category theory, for a particularly simple class of computing systems. At a conceptual level, a finite state machine can be considered a black box that receives a sequence of input signal and produces an output signal for each input signal. Internally, the black box maintains a <em>state</em> -- some sort of finite summary representation of the sequence of input signals encountered so far. For each input signal, the box performs two operations. In both cases, the decision depends on the current internal state and the identity of the input signal just received.</p><ul><li><strong>Chose next state</strong></li><li><strong>Generate output token</strong></li></ul><p>It is helpful to view the finite state machine layer as a mechanism to simulate a <em>Markov chain</em> or <em>Markov process</em>.</p><h2 id="Markov-Chain-for-Discrete-Time-Trajectories"><a class="docs-heading-anchor" href="#Markov-Chain-for-Discrete-Time-Trajectories">Markov Chain for Discrete-Time Trajectories</a><a id="Markov-Chain-for-Discrete-Time-Trajectories-1"></a><a class="docs-heading-anchor-permalink" href="#Markov-Chain-for-Discrete-Time-Trajectories" title="Permalink"></a></h2><p>Roughly speaking, a <em>Markov chain</em>, <span>$\bf{X}$</span>, is a probabilistic system that makes random jumps among a finite set of distinct states, <span>$s_0, s_1, s_2, \ldots, s_N$</span> such that the probability of choosing the next state, <span>$X_{n+1}$</span> depends only on the current state, <span>$X_n$</span>. In mathematical terms, the conditional probabilities for state transitions must satisfy</p><p class="math-container">\[\mathcal{P}[X_{n+1} = s_{l} | X_0=s_i, X_1=s_j, \ldots, X_n=s_k] =
\mathcal{P}[X_{n+1} = s_{l} | X_{n}=s_k]\]</p><p>Since more distant history does not affect future behavior, Markov chains are sometimes characterized as <em>memoryless</em>.</p><p>This relation can be iterated to compute the conditional probabilities for multiple time steps</p><p class="math-container">\[\mathcal{P}[X_{n+2} = s_{m} | X_n=s_k] = \sum_{l} \mathcal{P}[X_{n+2} = s_{m} |
X_{n+1}=s_l] \mathcal{P}[X_{n+1} = s_{l} | X_{n}=s_k]\]</p><p>Note, the transition probabilities <span>$\mathcal{P}[X_{n+1} = s_{l} | X_{n}=s_k]$</span> may depend on time (through the index <span>$n$</span>). These so-called time-inhomogeneous Markov chains arise when the system of interest is driven by external entities. Chains with time-independent conditional transition probabilities are called time-homogeneous. The dynamics of a time-homogeneous Markov chain is completely determined by the initial state and the transition probabilities. All processes considered in this document are time-homogeneous.</p><h2 id="Markov-Process-for-Continuous-Time-Trajectories"><a class="docs-heading-anchor" href="#Markov-Process-for-Continuous-Time-Trajectories">Markov Process for Continuous-Time Trajectories</a><a id="Markov-Process-for-Continuous-Time-Trajectories-1"></a><a class="docs-heading-anchor-permalink" href="#Markov-Process-for-Continuous-Time-Trajectories" title="Permalink"></a></h2><p>A <em>Markov process</em> is a generalization of the Markov chain such that time is viewed as continuous rather than discrete. As a result, it makes sense to record the times at which the transitions occur as part of the process itself.</p><p>The first step in this generalization is to define a stochastic process <span>$\bf{Y}$</span> that includes the transition times as well as the state, <span>$Y_{n} = (s_{j},t_{n})$</span>.</p><p>The second step is to treat time on a truly continuous basis by defining a new stochastic process, <span>$\bf{Z}$</span>, from <span>$\bf{Y}$</span> by the rule <span>$Z_{t} = s_k$</span> in the time interval <span>$t_n \le t &lt; t_{n+1}$</span> given <span>$Y_{n} = (s_k, t_n)$</span> . In other words, <span>$\bf{Z}_{t}$</span> is a piecewise constant version of <span>$\bf{Y}$</span> as shown in <code>piecewise_Z</code>.</p><p><img src="../assets/piecewise_Z.svg" alt="Figure 4. **Realization of a continuous time stochastic process and associated Markov chain.**"/></p><p>A realization of the process <span>$\bf{Y}$</span> is defined by the closed diamonds (left end points) alone. Similarly, a realization of the process <span>$\bf{Z}_t$</span> is illustrated by the closed diamonds and line segments. The closed and open diamonds at the ends of the line segment indicate that the segments include the left but not the right end points.</p><p>The memoryless property for Markov processes is considerably more delicate than in the case of Markov chain because the time variable is continuous rather than discrete. In the case of <span>$\bf{Y}$</span>, the conditional probabilities for state transitions of must satisfy</p><p class="math-container">\[\mathcal{P}[Y_{n+1} = (s_{l},t_{n+1}) | Y_0=(s_i, t_0), Y_1=(s_j, t_1),
\ldots, Y_n=(s_k, t_n)] =
\mathcal{P}[Y_{n+1} = (s_{l}, t_{n+1}) | Y_{n}=(s_k, t_{n})]\]</p><p>The proper generalization of the requirement of time-homeogeneity stated previously for Markov chains is that joint probability be unchanged by uniform shifts in time</p><p class="math-container">\[\mathcal{P}[Z_{t+\tau} | Z_{s+\tau}] = \mathcal{P}[Z_{t} | Z_{s} ]\]</p><p>for <span>$0&lt;s&lt;t$</span> and <span>$\tau &gt; 0$</span>. Stochastic processes with shift invariant state transition probabilities are called <em>stationary</em>.</p><p>When we examined hazard rates above, we were examining the rate of transitions for a Markov process. The overall probability of the next state of the Markov process is called the core matrix,</p><p class="math-container">\[\mathcal{P}[Z_{t} | Z_{s} ]=Q_{ij}(t_{n+1}-t_n)\]</p><p>indicating a state change between the states <span>$(s_i,s_j)$</span>. The derivative of this is a rate,</p><p class="math-container">\[q_{ij}(t_{n+1}-t_n)=\frac{dQ_{ij}(t_{n+1}-t_n)}{dt},\]</p><p>which is a joint distribution over states and time intervals. Normalization for this quantity sums over possible states and future times,</p><p class="math-container">\[1=\int_0^\infty \sum_j  q_{ij}(s)ds.\]</p><p>The survival, in terms of the core matrix, is</p><p class="math-container">\[G_i(\tau)=1-\int_0^\tau \sum_k  q_{ik}(s)ds.\]</p><p>This means our hazard is</p><p class="math-container">\[\lambda_{ij}(\tau)=\frac{q_{ij}(\tau)}{1-\int_0^\tau \sum_k  q_{ik}(s)ds}.\]</p><p>For the measles example, the set of future states <span>$j$</span> of each individual include symptomatic and all the possible other ways an individual leaves the study, so you can think of <span>$j=\mbox{left town}$</span>. In practice, we build a hazard in two steps. First, count the probability over all time for any one eventual state <span>$j$</span>. This is the same stochastic probability <span>$\pi_{ij}$</span> that is seen in Markov chains. Second, measure the distribution of times at which intervals enter each new state <span>$j$</span>, given that they are headed to that state. This is called the holding time, <span>$h_{ij}(\tau)$</span>, and is a conditional probability. Together, these two give us the core matrix,</p><p class="math-container">\[q_{ij}(\tau)=\pi_{ij}h_{ij}(\tau).\]</p><p>Note that <span>$h_{ij}(\tau)$</span> is a density whose integral <span>$H_{ij}(\tau)$</span> is a cumulative distribution. If we write the same equation in terms of probabilities, we see that it amounts to separating the Markov process into a marginal and conditional distribution.</p><p class="math-container">\[\begin{aligned}
q_{ij}(\tau)&amp;=\frac{d}{d\tau}P[Z_t|Z_s] \\
&amp;=\frac{d}{d\tau}P[s_j|s_i,t_n]P[t_{n-1}-t_n\le\tau|s_i,s_j,t_n] \\
  &amp; =  P[s_j|s_i,t_n]\frac{d}{d\tau}P[t_{n-1}-t_n\le\tau|s_i,s_j,t_n] \\
  &amp; =  \pi_{ij}\frac{d}{d\tau}H_{ij}(\tau) \\
  &amp; =  \pi_{ij}h_{ij}(\tau)
\end{aligned}\]</p><p>Choosing the other option for the marginal gives us the waiting time formulation for the core matrix. It corresponds to asking first what is the distribution of times at which the next event happens, no matter which event, and then asking which events are more likely given the time of the event.</p><p class="math-container">\[\begin{aligned}
q_{ij}(\tau)&amp;=\frac{d}{d\tau}P[Z_t|Z_s] \\
&amp;=\frac{d}{d\tau}P[s_j|s_i,t_n,t_{n+1}]P[t_{n-1}-t_n\le\tau|s_i,t_n] \\
  &amp; =  \frac{d}{d\tau}(\Pi_{ij}(\tau)W_i(\tau)) \\
  &amp; =  \pi_{ij}(\tau)\frac{d}{d\tau}W_i(\tau) \\
  &amp; =  \pi_{ij}(\tau)w_{i}(\tau)
\end{aligned}\]</p><p>While the waiting time density <span>$w_i(\tau)$</span>, is the derivative of the waiting time, we won&#39;t end up needing to relation <span>$\pi_{ij}(\tau)$</span> to <span>$\Pi_{ij}(\tau)$</span> when finding trajectories or computing hazards, so the more complicated relationship won&#39;t be a problem.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><p>[Stocks:1931]	P. Stocks, “<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2313639/">Incubation period of measles</a>,” British Medical Journal 1(3655): p. 157.</p><h2 id="Acknowledgement"><a class="docs-heading-anchor" href="#Acknowledgement">Acknowledgement</a><a id="Acknowledgement-1"></a><a class="docs-heading-anchor-permalink" href="#Acknowledgement" title="Permalink"></a></h2><p>This section comes was created by the Analytical Framework for Infectious Disease Dynamics (AFIDD) group at Cornell University in conjunction with the USDA Agricultural Research Service. This work was supported by the Science &amp; Technology Directorate, Department of Homeland Security via interagency agreement no. HSHQDC-10-X-00138.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../distrib/">« Notation for Distributions</a><a class="docs-footer-nextpage" href="../gsmp/">GSMP »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Wednesday 29 May 2024 11:54">Wednesday 29 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
